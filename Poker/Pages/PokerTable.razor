@page "/pokertable/{TableId:guid}"
@inject Poker.Data.PokerDbContext PokerDbContext
@inject Poker.Helpers.Dealers Dealers

<PokerTableComponent Table=@table FromSeat=@fromSeat />

@code {
  [Parameter]
  public Guid TableId { get; set; }

  Table table = null;
  int fromSeat = 0;

  protected async override Task OnInitializedAsync()
  {
      table = await PokerDbContext.Tables
                        .Include(table => table.Seats)
                            .ThenInclude(s => s.Player)
                        .SingleOrDefaultAsync(t => t.Id == TableId);

      if (table != null)
      {
          table.StateHasChangedDelegate += MyChangeHandler;
          var dealer = Dealers.DealerForTable(table);
          fromSeat = new Random().Next(table.TotalSeats - 1) + 1;
      }
  }


  private async void MyChangeHandler()
  {
      await InvokeAsync(() => StateHasChanged());
  }

}
